(function(){"use strict";var e={5478:function(e,s,t){var o=t(9242),a=t(3396);function n(e,s,t,o,n,r){const l=(0,a.up)("NavBar"),c=(0,a.up)("router-view");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(l),((0,a.wg)(),(0,a.j4)(c,{key:e.$route.fullPath}))],64)}t(8052);var r=t(7139);const l={class:"navbar navbar-expand-lg navbar-light bg-light"},c={class:"container"},u=(0,a.Uk)("Myspace"),i=(0,a._)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarText","aria-controls":"navbarText","aria-expanded":"false","aria-label":"Toggle navigation"},[(0,a._)("span",{class:"navbar-toggler-icon"})],-1),p={class:"collapse navbar-collapse",id:"navbarText"},d={class:"navbar-nav me-auto mb-2 mb-lg-0"},m={class:"nav-item"},f=(0,a.Uk)("首页"),_={class:"nav-item"},v=(0,a.Uk)("用户列表"),w={key:0,class:"navbar-nav"},g={class:"nav-item"},b=(0,a.Uk)("登录"),y={class:"nav-item"},h=(0,a.Uk)("注册"),k={key:1,class:"navbar-nav"},j={class:"nav-item"},C={class:"nav-item"};function U(e,s,t,o,n,U){const T=(0,a.up)("router-link");return(0,a.wg)(),(0,a.iD)("nav",l,[(0,a._)("div",c,[(0,a.Wm)(T,{class:"navbar-brand",to:{name:"home"}},{default:(0,a.w5)((()=>[u])),_:1}),i,(0,a._)("div",p,[(0,a._)("ul",d,[(0,a._)("li",m,[(0,a.Wm)(T,{class:"nav-link",to:{name:"home"}},{default:(0,a.w5)((()=>[f])),_:1})]),(0,a._)("li",_,[(0,a.Wm)(T,{class:"nav-link",to:{name:"userlist"}},{default:(0,a.w5)((()=>[v])),_:1})])]),e.$store.state.user.is_login?((0,a.wg)(),(0,a.iD)("ul",k,[(0,a._)("li",j,[(0,a.Wm)(T,{class:"nav-link",to:{name:"userprofile",params:{userId:e.$store.state.user.id}}},{default:(0,a.w5)((()=>[(0,a.Uk)((0,r.zw)(e.$store.state.user.username),1)])),_:1},8,["to"])]),(0,a._)("li",C,[(0,a._)("a",{class:"nav-link",style:{cursor:"pointer"},onClick:s[0]||(s[0]=s=>e.$store.dispatch("logout"))},"退出")])])):((0,a.wg)(),(0,a.iD)("ul",w,[(0,a._)("li",g,[(0,a.Wm)(T,{class:"nav-link",to:{name:"login"}},{default:(0,a.w5)((()=>[b])),_:1})]),(0,a._)("li",y,[(0,a.Wm)(T,{class:"nav-link",to:{name:"register"}},{default:(0,a.w5)((()=>[h])),_:1})])]))])])])}var T={name:"NavBar"},x=t(89);const B=(0,x.Z)(T,[["render",U]]);var D=B,P={name:"App",components:{NavBar:D}};const I=(0,x.Z)(P,[["render",n]]);var O=I,z=t(678);const H=(0,a.Uk)(" 首页 ");function W(e,s,t,o,n,r){const l=(0,a.up)("ContentBase");return(0,a.wg)(),(0,a.j4)(l,null,{default:(0,a.w5)((()=>[H])),_:1})}const Z={class:"home"},q={class:"container"},A={class:"card"},V={class:"card-body"};function R(e,s,t,o,n,r){return(0,a.wg)(),(0,a.iD)("div",Z,[(0,a._)("div",q,[(0,a._)("div",A,[(0,a._)("div",V,[(0,a.WI)(e.$slots,"default",{},void 0,!0)])])])])}var S={name:"ContentBase"};const M=(0,x.Z)(S,[["render",R],["__scopeId","data-v-5d4bf6fa"]]);var $=M,E={name:"HomeView",components:{ContentBase:$}};const F=(0,x.Z)(E,[["render",W]]);var L=F;const N=["onClick"],Y={class:"card-body"},K={class:"row"},G={class:"col-1 photo"},J=["src"],Q={class:"col-11"},X={class:"username"},ee={class:"follower-count"};function se(e,s,t,o,n,l){const c=(0,a.up)("ContentBase");return(0,a.wg)(),(0,a.j4)(c,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(o.users,(e=>((0,a.wg)(),(0,a.iD)("div",{class:"card single-user",key:e.id,onClick:s=>o.go_to_user_profile(e.id)},[(0,a._)("div",Y,[(0,a._)("div",K,[(0,a._)("div",G,[(0,a._)("img",{class:"img-fluid",src:e.photo,alt:""},null,8,J)]),(0,a._)("div",Q,[(0,a._)("div",X,(0,r.zw)(e.username),1),(0,a._)("div",ee,"粉丝："+(0,r.zw)(e.followerCount),1)])])])],8,N)))),128))])),_:1})}var te=t(4870),oe=t(7387),ae=t.n(oe),ne=t(65),re={name:"UserList",components:{ContentBase:$},setup(){const e=(0,ne.oR)(),s=s=>{e.state.user.is_login?Ts.push({name:"userprofile",params:{userId:s}}):Ts.push({name:"login"})};let t=(0,te.iH)(null);return ae().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/userlist/",type:"get",success:e=>{t.value=e}}),{users:t,go_to_user_profile:s}}};const le=(0,x.Z)(re,[["render",se],["__scopeId","data-v-2de32112"]]);var ce=le;const ue={class:"row"},ie={class:"col-3"},pe={class:"col-9"};function de(e,s,t,o,n,r){const l=(0,a.up)("UserProfileInfo"),c=(0,a.up)("UserProfileWrite"),u=(0,a.up)("UserProfilePosts"),i=(0,a.up)("ContentBase");return(0,a.wg)(),(0,a.j4)(i,null,{default:(0,a.w5)((()=>[(0,a._)("div",ue,[(0,a._)("div",ie,[(0,a.Wm)(l,{onFollow:o.follow,onUnfollow:o.unfollow,user:o.user},null,8,["onFollow","onUnfollow","user"]),o.user.id==e.$store.state.user.id?((0,a.wg)(),(0,a.j4)(c,{key:0,onPost_a_post:o.post_a_post},null,8,["onPost_a_post"])):(0,a.kq)("",!0)]),(0,a._)("div",pe,[(0,a.Wm)(u,{onDelete_a_post:o.delete_a_post,user:o.user,posts:o.posts},null,8,["onDelete_a_post","user","posts"])])])])),_:1})}const me={class:"card"},fe={class:"card-body"},_e={class:"row"},ve={class:"col-4 photo"},we=["src"],ge={class:"col-8"},be={class:"username"},ye={class:"fans"};function he(e,s,t,o,n,l){return(0,a.wg)(),(0,a.iD)("div",me,[(0,a._)("div",fe,[(0,a._)("div",_e,[(0,a._)("div",ve,[(0,a._)("img",{class:"img-fluid",src:t.user.photo,alt:""},null,8,we)]),(0,a._)("div",ge,[(0,a._)("div",be,(0,r.zw)(t.user.username),1),(0,a._)("div",ye,"粉丝："+(0,r.zw)(t.user.followerCount),1),t.user.is_followed?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("button",{key:0,onClick:s[0]||(s[0]=(...e)=>o.follow&&o.follow(...e)),type:"button",class:"btn btn-secondary btn-sm"},"+关注")),t.user.is_followed?((0,a.wg)(),(0,a.iD)("button",{key:1,onClick:s[1]||(s[1]=(...e)=>o.unfollow&&o.unfollow(...e)),type:"button",class:"btn btn-secondary btn-sm"},"取消关注")):(0,a.kq)("",!0)])])])])}var ke={name:"UserProfileInfo",props:{user:{type:Object,required:!0}},setup(e,s){const t=(0,ne.oR)(),o=()=>{ae().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/follow/",type:"post",data:{source_id:t.state.user.id,target_id:e.user.id},headers:{Authorization:"Bearer "+t.state.user.accessToken},success(e){"success"===e.result&&s.emit("follow")}})},a=()=>{ae().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/follow/",type:"post",data:{source_id:t.state.user.id,target_id:e.user.id},headers:{Authorization:"Bearer "+t.state.user.accessToken},success(e){"success"===e.result&&s.emit("unfollow")}})};return{follow:o,unfollow:a}}};const je=(0,x.Z)(ke,[["render",he],["__scopeId","data-v-8edf4852"]]);var Ce=je;const Ue={class:"card"},Te={class:"card-body"},xe={class:"card single-post"},Be={class:"card-body"},De=["onClick"];function Pe(e,s,t,o,n,l){return(0,a.wg)(),(0,a.iD)("div",Ue,[(0,a._)("div",Te,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(t.posts.posts,(e=>((0,a.wg)(),(0,a.iD)("div",{key:e.id},[(0,a._)("div",xe,[(0,a._)("div",Be,[(0,a.Uk)((0,r.zw)(e.content)+" ",1),o.is_me?((0,a.wg)(),(0,a.iD)("button",{key:0,onClick:s=>o.delete_a_post(e.id),type:"button",class:"btn btn-danger btn-sm"},"删除",8,De)):(0,a.kq)("",!0)])])])))),128))])])}var Ie={name:"UserProfilePosts",props:{posts:{type:Object,required:!0},user:{type:Object,required:!0}},setup(e,s){const t=(0,ne.oR)(),o=e=>{ae().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/post/",type:"DELETE",data:{post_id:e},headers:{Authorization:"Bearer "+t.state.user.accessToken},success(t){"success"===t.result&&s.emit("delete_a_post",e)}})};let n=(0,a.Fl)((()=>t.state.user.id===e.user.id));return{is_me:n,delete_a_post:o}}};const Oe=(0,x.Z)(Ie,[["render",Pe],["__scopeId","data-v-9777e328"]]);var ze=Oe;const He=e=>((0,a.dD)("data-v-7d432355"),e=e(),(0,a.Cn)(),e),We={class:"card edit-field"},Ze={class:"card-body"},qe=He((()=>(0,a._)("label",{for:"edit-post",class:"form-label"},"编辑帖子",-1)));function Ae(e,s,t,n,r,l){return(0,a.wg)(),(0,a.iD)("div",We,[(0,a._)("div",Ze,[qe,(0,a.wy)((0,a._)("textarea",{"onUpdate:modelValue":s[0]||(s[0]=e=>n.content=e),class:"form-control",id:"edit-post",rows:"3"},null,512),[[o.nr,n.content]]),(0,a._)("button",{onClick:s[1]||(s[1]=(...e)=>n.post_a_post&&n.post_a_post(...e)),type:"button",class:"btn btn-primary btn-sm"},"发帖")])])}var Ve={name:"UserProfileWrite",setup(e,s){let t=(0,te.iH)("");const o=(0,ne.oR)(),a=()=>{ae().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/post/",type:"POST",data:{content:t.value},headers:{Authorization:"Bearer "+o.state.user.accessToken},success(e){"success"===e.result&&(s.emit("post_a_post",t.value),t.value="")}})};return{content:t,post_a_post:a}}};const Re=(0,x.Z)(Ve,[["render",Ae],["__scopeId","data-v-7d432355"]]);var Se=Re,Me={name:"UserList",components:{ContentBase:$,UserProfileInfo:Ce,UserProfilePosts:ze,UserProfileWrite:Se},setup(){const e=(0,z.yj)(),s=parseInt(e.params.userId),t=(0,te.qj)({}),o=(0,ne.oR)();ae().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/getinfo/",type:"get",data:{user_id:s,me_id:o.state.user.id},success(e){t.id=e.id,t.username=e.username,t.photo=e.photo,t.followerCount=e.followerCount,t.is_followed=e.is_followed}});const a=(0,te.qj)({count:0,posts:[]});ae().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/post/",type:"GET",data:{user_id:s},headers:{Authorization:"Bearer "+o.state.user.accessToken},success(e){a.count=e.length,a.posts=e}});const n=()=>{t.is_followed||(t.is_followed=!0,t.followerCount++)},r=()=>{t.is_followed&&(t.is_followed=!1,t.followerCount--)},l=e=>{a.count++,a.posts.unshift({id:a.count,userId:1,content:e})},c=e=>{a.count--,a.posts=a.posts.filter((s=>s.id!==e))};return{user:t,follow:n,unfollow:r,posts:a,post_a_post:l,delete_a_post:c}}};const $e=(0,x.Z)(Me,[["render",de]]);var Ee=$e;const Fe=e=>((0,a.dD)("data-v-e9e1267c"),e=e(),(0,a.Cn)(),e),Le={class:"row justify-content-md-center"},Ne={class:"col-3"},Ye={class:"mb-3"},Ke=Fe((()=>(0,a._)("label",{for:"username",class:"form-label"},"用户名",-1))),Ge={class:"mb-3"},Je=Fe((()=>(0,a._)("label",{for:"password",class:"form-label"},"密码",-1))),Qe={class:"error_message"},Xe=Fe((()=>(0,a._)("button",{type:"submit",class:"btn btn-primary"},"登录",-1)));function es(e,s,t,n,l,c){const u=(0,a.up)("ContentBase");return(0,a.wg)(),(0,a.j4)(u,null,{default:(0,a.w5)((()=>[(0,a._)("div",Le,[(0,a._)("div",Ne,[(0,a._)("form",{onSubmit:s[2]||(s[2]=(0,o.iM)(((...e)=>n.login&&n.login(...e)),["prevent"]))},[(0,a._)("div",Ye,[Ke,(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>n.username=e),type:"text",class:"form-control",id:"username"},null,512),[[o.nr,n.username]])]),(0,a._)("div",Ge,[Je,(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>n.password=e),type:"password",class:"form-control",id:"password"},null,512),[[o.nr,n.password]])]),(0,a._)("div",Qe,(0,r.zw)(n.error_message),1),Xe],32)])])])),_:1})}var ss={name:"LoginView",components:{ContentBase:$},setup(){let e=(0,te.iH)(""),s=(0,te.iH)(""),t=(0,te.iH)("");const o=(0,ne.oR)(),a=()=>{t.value="",o.dispatch("login",{username:e.value,password:s.value,success(){Ts.push({name:"userlist"})},error(){t.value="用户名或密码错误"}})};return{username:e,password:s,error_message:t,login:a}}};const ts=(0,x.Z)(ss,[["render",es],["__scopeId","data-v-e9e1267c"]]);var os=ts;const as=e=>((0,a.dD)("data-v-2fdaeb46"),e=e(),(0,a.Cn)(),e),ns={class:"row justify-content-md-center"},rs={class:"col-3"},ls={class:"mb-3"},cs=as((()=>(0,a._)("label",{for:"username",class:"form-label"},"用户名",-1))),us={class:"mb-3"},is=as((()=>(0,a._)("label",{for:"password",class:"form-label"},"密码",-1))),ps={class:"mb-3"},ds=as((()=>(0,a._)("label",{for:"password_confirm",class:"form-label"},"确认密码",-1))),ms={class:"error_message"},fs=as((()=>(0,a._)("button",{type:"submit",class:"btn btn-primary"},"注册",-1)));function _s(e,s,t,n,l,c){const u=(0,a.up)("ContentBase");return(0,a.wg)(),(0,a.j4)(u,null,{default:(0,a.w5)((()=>[(0,a._)("div",ns,[(0,a._)("div",rs,[(0,a._)("form",{onSubmit:s[3]||(s[3]=(0,o.iM)(((...e)=>n.register&&n.register(...e)),["prevent"]))},[(0,a._)("div",ls,[cs,(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":s[0]||(s[0]=e=>n.username=e),type:"text",class:"form-control",id:"username"},null,512),[[o.nr,n.username]])]),(0,a._)("div",us,[is,(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>n.password=e),type:"password",class:"form-control",id:"password"},null,512),[[o.nr,n.password]])]),(0,a._)("div",ps,[ds,(0,a.wy)((0,a._)("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>n.password_confirm=e),type:"password",class:"form-control",id:"password_confirm"},null,512),[[o.nr,n.password_confirm]])]),(0,a._)("div",ms,(0,r.zw)(n.error_message),1),fs],32)])])])),_:1})}var vs={name:"RegisterView",components:{ContentBase:$},setup(){let e=(0,te.iH)(""),s=(0,te.iH)(""),t=(0,te.iH)(""),o=(0,te.iH)("");const a=(0,ne.oR)(),n=()=>{o.value="",ae().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/user/",type:"post",data:{username:e.value,password:s.value,password_confirm:t.value},success(t){"success"===t.result?a.dispatch("login",{username:e.value,password:s.value,success(){Ts.push({name:"userlist"})},error(){o.value="系统异常，请稍后重试"}}):o.value=t.result}})};return{username:e,password:s,password_confirm:t,error_message:o,register:n}}};const ws=(0,x.Z)(vs,[["render",_s],["__scopeId","data-v-2fdaeb46"]]);var gs=ws;const bs=(0,a.Uk)(" 404 ");function ys(e,s,t,o,n,r){const l=(0,a.up)("ContentBase");return(0,a.wg)(),(0,a.j4)(l,null,{default:(0,a.w5)((()=>[bs])),_:1})}var hs={name:"NotFound",components:{ContentBase:$}};const ks=(0,x.Z)(hs,[["render",ys]]);var js=ks;const Cs=[{path:"/myspace",name:"home",component:L},{path:"/myspace/userlist",name:"userlist",component:ce},{path:"/myspace/userprofile/:userId",name:"userprofile",component:Ee},{path:"/myspace/login",name:"login",component:os},{path:"/myspace/register",name:"register",component:gs},{path:"/myspace/404",name:"404",component:js},{path:"/myspace/:catchAll(.*)",redirect:"/myspace/404"}],Us=(0,z.p7)({history:(0,z.PO)(),routes:Cs});var Ts=Us,xs=t(1598);const Bs={state:{id:"",username:"",photo:"",accessToken:"",refreshToken:"",is_login:!1},getters:{},mutations:{updateUser:(e,s)=>{e.id=s.id,e.username=s.username,e.photo=s.photo,e.accessToken=s.accessToken,e.refreshToken=s.refreshToken,e.is_login=s.is_login},updateAccess:(e,s)=>{e.accessToken=s}},actions:{login:(e,s)=>{ae().ajax({url:"https://app165.acapp.acwing.com.cn/api/token/",type:"post",data:{username:s.username,password:s.password},success(t){const o=t.refresh,a=t.access,n=(0,xs.Z)(a);setInterval((()=>{ae().ajax({url:"https://app165.acapp.acwing.com.cn/api/token/refresh/",type:"post",data:{refresh:o},success(s){e.commit("updateAccess",s.access)}})}),27e4),ae().ajax({url:"https://app165.acapp.acwing.com.cn/myspace/getinfo/",type:"get",data:{user_id:n.user_id},success(t){e.commit("updateUser",{id:parseInt(t.id),username:t.username,photo:t.photo,accessToken:a,refreshToken:o,is_login:!0}),s.success()}})},error(){s.error()}})},logout:e=>{console.log("logout"),e.commit("updateUser",{id:"",username:"",accessToken:"",refreshToken:"",is_login:!1})}},modules:{}};var Ds=Bs,Ps=(0,ne.MT)({state:{},getters:{},mutations:{},actions:{},modules:{user:Ds}});(0,o.ri)(O).use(Ps).use(Ts).mount("#app")}},s={};function t(o){var a=s[o];if(void 0!==a)return a.exports;var n=s[o]={exports:{}};return e[o].call(n.exports,n,n.exports,t),n.exports}t.m=e,function(){var e=[];t.O=function(s,o,a,n){if(!o){var r=1/0;for(i=0;i<e.length;i++){o=e[i][0],a=e[i][1],n=e[i][2];for(var l=!0,c=0;c<o.length;c++)(!1&n||r>=n)&&Object.keys(t.O).every((function(e){return t.O[e](o[c])}))?o.splice(c--,1):(l=!1,n<r&&(r=n));if(l){e.splice(i--,1);var u=a();void 0!==u&&(s=u)}}return s}n=n||0;for(var i=e.length;i>0&&e[i-1][2]>n;i--)e[i]=e[i-1];e[i]=[o,a,n]}}(),function(){t.n=function(e){var s=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(s,{a:s}),s}}(),function(){t.d=function(e,s){for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};t.O.j=function(s){return 0===e[s]};var s=function(s,o){var a,n,r=o[0],l=o[1],c=o[2],u=0;if(r.some((function(s){return 0!==e[s]}))){for(a in l)t.o(l,a)&&(t.m[a]=l[a]);if(c)var i=c(t)}for(s&&s(o);u<r.length;u++)n=r[u],t.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return t.O(i)},o=self["webpackChunkmyspace"]=self["webpackChunkmyspace"]||[];o.forEach(s.bind(null,0)),o.push=s.bind(null,o.push.bind(o))}();var o=t.O(void 0,[998],(function(){return t(5478)}));o=t.O(o)})();
//# sourceMappingURL=app.6b905898.js.map